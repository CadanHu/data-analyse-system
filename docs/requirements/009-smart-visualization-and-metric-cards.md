# 需求文档 009: 智慧可视化升级与指标卡片支持

## 1. 背景
原有的图表展示过于死板，无法根据业务语义自动选择最优展示方式，且对于单点指标（如总数）展示表格过于繁琐。

## 2. 核心修改
- **Agent 决策链**：
    - 在 SQL 生成 Prompt 中引入 `viz_config` 元数据。
    - 强制 Agent 思考：是趋势 (Line)、对比 (Bar) 还是占比 (Pie)？
- **指标卡片 (Metric Card)**：
    - 新增 `card` 类型图表。
    - 针对单行单列的汇总数据，展示大字号数字艺术卡片。
- **智能映射**：
    - 解决坐标轴反转：AI 明确指定 `x` 轴和 `y` 轴字段名。
    - 降级方案：若 AI 建议缺失，前端自动执行启发式字段匹配。
- **历史回看修复**：
    - 打通消息历史与 Store 的同步，点击旧消息按钮可完美复现当时的可视化画面。

## 3. 验证标准
- 提问“订单总数”显示指标卡片。
- 提问“按月趋势”显示折线图。
- 历史记录回看时，点击图表按钮不再出现空白。
